{"openapi":"3.1.0","info":{"title":"Artisan AI API","description":"Backend for AI-powered artisan marketplace (Firestore-first; Vertex/GCS optional).","version":"0.1.0"},"paths":{"/v1/products/{product_id}":{"post":{"tags":["products"],"summary":"Upsert Product","description":"Accept raw dict to keep URLs as plain strings. If an image arrives as a base64\ndata URI, store it and replace with a short URL before validating with Product.\nThis avoids Pydantic Url errors and keeps Firestore clean.","operationId":"upsert_product_v1_products__product_id__post","parameters":[{"name":"product_id","in":"path","required":true,"schema":{"type":"string","title":"Product Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","title":"Body"}}}},"responses":{"200":{"description":"Upserted","content":{"application/json":{"schema":{}}}},"400":{"description":"Bad Request"},"422":{"description":"Unprocessable Entity"},"500":{"description":"Internal Server Error"}}},"put":{"tags":["products"],"summary":"Upsert Product Put","operationId":"upsert_product_put_v1_products__product_id__put","parameters":[{"name":"product_id","in":"path","required":true,"schema":{"type":"string","title":"Product Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","title":"Body"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"tags":["products"],"summary":"Update Product","operationId":"update_product_v1_products__product_id__patch","parameters":[{"name":"product_id","in":"path","required":true,"schema":{"type":"string","title":"Product Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","title":"Patch"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["products"],"summary":"Get Product","operationId":"get_product_v1_products__product_id__get","parameters":[{"name":"product_id","in":"path","required":true,"schema":{"type":"string","title":"Product Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["products"],"summary":"Delete Product","operationId":"delete_product_v1_products__product_id__delete","parameters":[{"name":"product_id","in":"path","required":true,"schema":{"type":"string","title":"Product Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/products/":{"get":{"tags":["products"],"summary":"List Products","operationId":"list_products_v1_products__get","parameters":[{"name":"category","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by category","title":"Category"},"description":"Filter by category"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"default":24,"title":"Limit"}},{"name":"cursor_ts","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"ISO ts from previous next.ts","title":"Cursor Ts"},"description":"ISO ts from previous next.ts"},{"name":"cursor_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Doc id from previous next.id","title":"Cursor Id"},"description":"Doc id from previous next.id"},{"name":"include_inactive","in":"query","required":false,"schema":{"type":"boolean","description":"Include soft-deleted items","default":false,"title":"Include Inactive"},"description":"Include soft-deleted items"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/products/{product_id}/popularity":{"post":{"tags":["products"],"summary":"Bump Popularity","operationId":"bump_popularity_v1_products__product_id__popularity_post","parameters":[{"name":"product_id","in":"path","required":true,"schema":{"type":"string","title":"Product Id"}},{"name":"delta","in":"query","required":false,"schema":{"type":"integer","default":1,"title":"Delta"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/products/{product_id}/generate":{"post":{"tags":["products"],"summary":"Generate Content","operationId":"generate_content_v1_products__product_id__generate_post","parameters":[{"name":"product_id","in":"path","required":true,"schema":{"type":"string","title":"Product Id"}},{"name":"mode","in":"query","required":false,"schema":{"enum":["sync","event"],"type":"string","default":"sync","title":"Mode"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GenerateRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/marketing/{product_id}/post":{"post":{"tags":["marketing"],"summary":"Marketing Post","description":"mode=sync  → generate caption now (mock in Firebase-only; Gemini when enabled)\nmode=event → publish 'marketing.asset.requested' for worker to process later","operationId":"marketing_post_v1_marketing__product_id__post_post","parameters":[{"name":"product_id","in":"path","required":true,"schema":{"type":"string","title":"Product Id"}},{"name":"lang","in":"query","required":false,"schema":{"type":"string","default":"en","title":"Lang"}},{"name":"channel","in":"query","required":false,"schema":{"type":"string","default":"instagram","title":"Channel"}},{"name":"mode","in":"query","required":false,"schema":{"type":"string","pattern":"^(sync|event)$","default":"sync","title":"Mode"}}],"requestBody":{"content":{"application/json":{"schema":{"anyOf":[{"type":"array","items":{"type":"string"}},{"type":"null"}],"title":"Extra Tags"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/marketing/suggest":{"get":{"tags":["marketing"],"summary":"Suggest","operationId":"suggest_v1_marketing_suggest_get","parameters":[{"name":"channel","in":"query","required":false,"schema":{"type":"string","default":"instagram","title":"Channel"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/recs/user/{user_id}":{"get":{"tags":["recs"],"summary":"Recs For User","operationId":"recs_for_user_v1_recs_user__user_id__get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"k","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"default":12,"title":"K"}},{"name":"category_hint","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"e.g., 'woodwork', 'textile'","title":"Category Hint"},"description":"e.g., 'woodwork', 'textile'"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/recs/similar/{product_id}":{"get":{"tags":["recs"],"summary":"Recs Similar","operationId":"recs_similar_v1_recs_similar__product_id__get","parameters":[{"name":"product_id","in":"path","required":true,"schema":{"type":"string","title":"Product Id"}},{"name":"k","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"default":12,"title":"K"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/recs/popular":{"get":{"tags":["recs"],"summary":"Recs Popular","operationId":"recs_popular_v1_recs_popular_get","parameters":[{"name":"k","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"default":12,"title":"K"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/recs/search":{"post":{"tags":["recs"],"summary":"Recs Search","operationId":"recs_search_v1_recs_search_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/uploads/sign":{"post":{"tags":["uploads"],"summary":"Sign Upload","operationId":"sign_upload_v1_uploads_sign_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SignRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SignResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/uploads/signed-url":{"get":{"tags":["uploads"],"summary":"Get Signed Url","operationId":"get_signed_url_v1_uploads_signed_url_get","parameters":[{"name":"filename","in":"query","required":true,"schema":{"type":"string","minLength":1,"title":"Filename"}},{"name":"contentType","in":"query","required":false,"schema":{"type":"string","default":"application/octet-stream","title":"Contenttype"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SignResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/healthz":{"get":{"summary":"Health","operationId":"health_healthz_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/livez":{"get":{"summary":"Live","operationId":"live_livez_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/readyz":{"get":{"summary":"Ready","operationId":"ready_readyz_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"GenerateRequest":{"properties":{"langs":{"items":{"type":"string"},"type":"array","title":"Langs"},"tone":{"type":"string","title":"Tone","description":"narrative|professional|playful|luxury|...","default":"narrative"}},"type":"object","title":"GenerateRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"SearchRequest":{"properties":{"query":{"type":"string","maxLength":200,"minLength":1,"title":"Query"},"k":{"type":"integer","maximum":100.0,"minimum":1.0,"title":"K","description":"number of results","default":12}},"type":"object","required":["query"],"title":"SearchRequest"},"SignRequest":{"properties":{"filename":{"type":"string","minLength":1,"title":"Filename"},"contentType":{"type":"string","title":"Contenttype","description":"MIME type of the file (e.g., image/png)","default":"application/octet-stream"}},"type":"object","required":["filename"],"title":"SignRequest"},"SignResponse":{"properties":{"upload_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Upload Url"},"public_url":{"type":"string","title":"Public Url"},"object_name":{"type":"string","title":"Object Name"}},"type":"object","required":["upload_url","public_url","object_name"],"title":"SignResponse"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}